<!doctype html><head><script src="../eveal.js/eveal.js"></script></head><body>
<style>code { background-color:#eee; color:red; }</style>

## Kubernetes
### Special Topic

<img src="odocker-small.jpg">

<small>
  Tracey, Jonah and DVD
  <br/>
  June 2018
</small>

<small>
  _?_ for keyboard shortcuts<br/>
</small>


---
### Overview
- 13 nodes (VMs) and growing
- `kubectl` v1.10
- using `k3s` to setup
- RBAC
  - namespaces
  - like unix users and groups
  - ssh alternative

---
### How would I?
- https://git.archive.org/ia/TechDocs/blob/master/guides/docker.md
- create docker container on laptop
- `docker login docker.archive.org`
- `dodker push docker.archive.org/neat-webapp`


---
### How would I?
- https://git.archive.org/ia/TechDocs/blob/master/guides/kubernetes.md
- setup namespace or use global
- `kubectl` yaml/json to setup:
  - `docker pull docker.archive.org/neat-webapp`
  - pod [group of services/daemons]
  - replicaSet, deployment, load balancer

---
### eg: deploy [IIIF](https://iiif.io/) app to kubernetes

```sh
kubectl run iiif --image=registry.example.com/ia/iiif/master:latest --port=8080

kubectl expose deployment iiif --port 8080 --target-port 8080 --type=NodePort

kubectl patch svc/iiif  -p='{"spec":{
   "ports":[
     {"name":"http", "port":  8080, "protocol":"TCP", "nodePort": 30303, "targetPort":  8080}
   ]
 }}
```

---
### Survey of early adopters
- persistent store
  - 'great!  but I have small custom postgres DB..'
- networking / ingress
  - 'how do I point url hostname at cutover?'


---
### Networking
- using `weave` now
  - each node/VM gets weave container
  - can route any ingressed traffic to other K8 nodes
- can point `name.archive.org` to a node IP addy

---
### Persisent Store
- start with 4 nodes, 10TB shared 'disk'
- glusterFS
- raid 10 avoids corruption

---
### 'You can Go Your Own Way'
- Easy to take a group of xenial+ VMs
- run some simple setup (for `k3s` and `kubectl` etc.)
- copy `.kube/config` to laptop
- good to go!

https://gitlab.com/internetarchive/kre8/-/blob/master/README.md#create-a-k8-cluster-as-needed

---
<!-- .slide: data-background="giphy.gif" -->
# THE END
