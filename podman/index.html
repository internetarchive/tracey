<!doctype html><head><meta charset="utf-8"/><script>window.REMOTE=1</script><script src="https://archive.org/~tracey/slides/eveal.js/eveal.js"></script><title>Containers Talk 2023/10</title></head><body>


# Container Security Improvements
## Tracey Jaquith, Rob Keizer, Scott Barnes
### Internet Archive üèõÔ∏è
#### Oct 26, 2023

---
## What's a Container?
![logo.jpg](logo.jpg)
- Standardization, abstraction
 - Think intermodal for software
- Single artifact
  - "I want 10 copies of this container"

---
## What's a Container?
![logo.jpg](logo.jpg)
- Lightweight, not a full virtual machine
- Contains everything needed to run
- One built runtime "url" / "file"*
- "Off the shelf" software

---
## How have Containers Helped Us?
- Standardized testing and deployment
 - Automated tests are run in containers
 - Review apps run in containers
- Management
 - Auditability, repeatability
 - Ability to roll complex changes back
 - Increased availability (relatively easily)

---
## How have Containers Helped Us?
_deriver_ (makes our mp4, mp3, pdf):
- Process isolation
  - r/w _single_ item dir
  - can't see/corrupt other tasks/files
- All intermediate file/changes removed at end

---
## Risks üòû
(`rootless` means non-root user)

<pre class="fragment fade-up">
‚Ä¢ If you run as root
    you can r/w ALL content & OS files
</pre>
<pre class="fragment fade-up">
‚Ä¢ attack root process
  - eg: docker daemon
</pre>
<pre class="fragment fade-up">
‚Ä¢ containers attacking other containers with same user
  - root user or *any* user
  - if all your data is r/w by same user:
      breaking out can r/w ALL THAT DATA
</pre>
<pre class="fragment fade-up">
‚Ä¢ VMs/servers attacking other VMs/servers
</pre>

---
## Risk Mitigation

*LIMIT WHAT YOU CAN WRITE TO ON DISK[S]*

---
## A container platform?
- Software that runs containers
- Handles administrative actions
 - `start/stop`, `view logs`, etc.
- Many different flavours
  - (`docker`, `podman`, `runc`, `lxc`, `...` )

---

![docker_vs_podman.jpeg](docker_vs_podman.jpeg)
- Currently using `docker`
- Looking seriously at `podman`
- Fewer moving parts
- Unix philosophy ( do one thing well )

---
# Help üôåüèª
- `podman` from RedHat
- opensource, free
- `docker` same commandline/features
  - (drop-in replacement)
- v1.0 on Jan 2019
- [569 Contributors](https://github.com/containers/podman)

---
# Help üôåüèª
- `podman` can run containers anywhere
  - since no `docker` daemon
  - no `iptables` / routing changes
- may help deriver container start/stop reliability

---
# Demo
"hello world" web page podman container

https://ia902601.us.archive.org/hi.php?tester=tracey

- `rootless`
- runs as `www-priv`
- no file r/w access

---
# Demo
```text
user: www-priv

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

```

---
# R & D
- TV "fixer" catalogd tasks
  - r/w _single_ item dir
  - running ~300/day

- epub "on the fly" `daisy` format
  - rootless container
  - (scheduled for release)

---

# Security++
- `podman` is just a process
- Going rootless

---
# The End üé¨
Thanks! üôè

We'd love to talk to anyone interested afterwards

![logo.jpg](logo.jpg)

---
# Bonus / After time:
- [jammy+] `podman` apt/debian pkg
- [focal] opensuse.org distro => `/etc/apt/sources.list.d/`

---
# apt packages
- _podman_
- _uidmap_: maps outside => inside userid/gid
- _slirp4netns_: rootless networking
- _fuse-overlayfs_: rootless file r/w
- _containernetworking-plugins_


---
# UID
podman "rootless" techniques:
- uid maps
- random user uid
  - hybrid of "rootfull" & "rootless"
  - better network & file r/w performance


---
# Rootless More Info
- [2023 rootless podman user namespaces in plain english](https://blog.podman.io/2023/05/rootless-podman-user-namespaces-in-plain-english/)
- [2023 podman performance root and rootless](https://blog.podman.io/2023/07/podman-performance-root-and-rootless/)

---
## rootless -v- rootfull
rootless slower than rootful:
- networking & storage ‚Äì must be done in _user space_ instead of _kernel space_
  - _storage_:
    - older kernels: FUSE filesystem `fuse-overlayfs`
    - newer kernels (5.11+, jammy): kernel allows `podman` the `overlayfs` filesystem natively as non-root user
  - _networking_: `slirp4netns` manually reassembles & forwards packets to container
    - speedup by r/w volume mounts
    - OR `podman run --net=host`
      - but `opsec` üìâ

---
## rootless -v- rootfull:
## random user id
-  `podman run --userns=auto` allows root `podman` to:
  - creates container w/ performance advantages of root
    - (kernel-native overlayfs & bridge networking)
  - runtime security advantages of rootless
    - container has no access to the host‚Äôs root user
