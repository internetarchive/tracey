<!doctype html><head>><meta charset="utf-8"/><script>window.BASE='https://www-tracey.archive.org/~tracey/slides/eveal.js/reveal.js/'</script><script src="https://www-tracey.archive.org/~tracey/slides/eveal.js/eveal.js"></script><title>Containers Talk 2023 October</title></head><body>
<!-- xxx ^^ www-tracey ^^ -->


# Container Security Improvements
## Tracey Jaquith, Rob Keizer, Scott Barnes
### Internet Archive ðŸ›ï¸
#### Oct 26, 2023

---
## What's a Container?

![logo.jpg](logo.jpg)

- code, OS, libraries/dependencies all in one code repository
- one built runtime "url" / "file"
  - lightweight VM
- `docker run hello-world`


---
## How have Containers Helped Us?
- CI/CD (Continuous Integration / Deploy)
  - code `commit` => `push` =>
    - builds, tests, deploys ðŸš€
- review apps great for org-wide testing

---
## How have Containers Helped Us?
_deriver_ (makes our mp4, mp3, pdf):
- process isolation
  - r/w _single_ item dir
  - can't see/corrupt other tasks/files
- all intermediate file/changes removed at end

---
## Risks ðŸ˜ž
(`rootless` means non-root user)

- if you run as root, you can _r/w_all content & OS files_
- attack root process
  - eg: docker daemon
- containers attacking other containers with same user
  - root user or *any* user
  - if all your data is r/w by the same user:
    - breaking out means can r/w _all that data_
- nodes attacking other nodes

---
## Risk Mitigation

*LIMIT WHAT YOU CAN WRITE TO ON DISK[S]*

---
# A New Way ðŸ¤”
We look into a lightweight container runner
- security first
- no docker daemon

---
# Help ðŸ™ŒðŸ»
- `podman` from RedHat
- opensource, free
- `docker` same commandline/features
  - (drop-in replacement)
- v1.0 on Jan 2019
- [569 Contributors](https://github.com/containers/podman)

---
# Help ðŸ™ŒðŸ»
- `podman` can run containers anywhere
  - since no `docker` daemon
  - no `iptables` / routing changes
- may help deriver container start/stop reliability

---
# Demo
"hello world" web page podman container

https://ia902601.us.archive.org/hi.php?tester=tracey

- `rootless`
- runs as `www-priv`
- no file r/w access

---
# Demo
```text
user: www-priv

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

```

---
# R & D
- TV "fixer" catalogd tasks
  - r/w _single_ item dir
  - running ~300/day

- epub "on the fly" `daisy` format
  - rootless container
  - (scheduled for release)

---
# Security++
- Rob K. more focus on security
- considering `podman` for our `nomad` clusters


---
# Rob



---
# The End ðŸŽ¬
Thanks! ðŸ™

We'd love to talk to anyone interested afterwards


---
# Bonus / After time:
- [jammy+] `podman` apt/debian pkg
- [focal] opensuse.org distro `/etc/apt/sources.list.d/`

---
# apt packages
- _podman_
- _uidmap_: maps outside => inside userid/gid
- _slirp4netns_: rootless networking
- _fuse-overlayfs_: rootless file r/w
- _containernetworking-plugins_


---
# UID
podman "rootless" techniques:
- uid maps
- random user uid
  - hybrid of "rootfull" and "rootless"
  - better network & file r/w performance


---
# Rootless More Info
- [2023 rootless-podman-user-namespaces-in-plain-english](https://blog.podman.io/2023/05/rootless-podman-user-namespaces-in-plain-english/)
- [2023 podman-performance-root-and-rootless](https://blog.podman.io/2023/07/podman-performance-root-and-rootless/)

---
## rootless -v- rootfull
rootless slower than rootful:
- networking & storage â€“ must be done in _user space_ instead of _kernel space_
  - _storage_: FUSE filesystem `fuse-overlayfs`
    - newer kernels (5.11+, jammy), `fuse-overlayfs` need removed: kernel allows `podman` to use overlayfs` filesystem natively as a non-root user
  - _networking_: a tool that manually reassembles & forwards packets to container `slirp4netns`
    - speedup by r/w volume mounts
    - can `podman run -net==host` to remedy, but `opsec--`

---
## rootless -v- rootfull:
## random user id
-  `podman run --userns=auto` allows root `podman` to:
  - creates container w/ performance advantages of root
    - (kernel-native overlayfs & bridge networking)
  - runtime security advantages of rootless
    - container has no access to the hostâ€™s root user
