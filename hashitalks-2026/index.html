<!doctype html><head><meta charset="utf-8"/><script src="../eveal.js/eveal.js?NIGHT"></script><style>.slide-background{background-image:url("i/bg.jpg")} .lefty{text-align:left}</style>
<title>HinD: Hashistack-in-Docker - Zero to production Nomad cluster in minutes : HashiTalks 2026 : Tracey Jaquith</title>
</head><body>


## HinD: Hashistack-in-Docker
### Zero to production Nomad cluster in minutes

HashiTalks 2026<br>
Tracey Jaquith<br>
slides: <a href="https://tracey.archive.org">tracey.archive.org</a>


---
<!-- .slide: data-background="talks-bg.jpg" -->
Want to run your own Nomad cluster
<div class="fragment">
but find the setup daunting?
</div><br>

<div class="fragment">
HinD (Hashistack-in-Docker)
</div>
<div class="fragment">
=> Nomad, Consul, and Caddy in one container
</div><br>

<div class="fragment">
Zero to a production-ready cluster
</div>
<div class="fragment">
in under 5 minutes
</div><br>


---
@tracey_pooh ğŸ§¸<br>
Internet Archive ğŸ›ï¸
<div class="fragment"><br>
founding coder<br>
Â· tv Â· video/audio Â· devops Â· javascript Â·<br>
</div>

<div class="fragment"><br><br>
<span class="fragment highlight-red">slides</span>: https://tracey.archive.org<br>
repo: [github/internetarchive](https://github.com/internetarchive/hind)<br>
</div>

---
<img src="i/containers-and-tracey.jpg" style="margin-top:-10%"/>
[tracey.archive.org](https://tracey.archive.org)


---
## What's HinD?
### Hashistack-IN-Docker

<div class="fragment">
One `podman` container<br>
running <em>inside</em> your VM
</div><br>

<div class="fragment">
Â· `nomad` â€” workload scheduler<br>
</div>
<div class="fragment">
Â· `consul` â€” service discovery + healthchecks<br>
</div>
<div class="fragment">
Â· `caddy` â€” reverse proxy + automatic HTTPS<br>
</div>
<div class="fragment">
Â· `consul-template` â€” consul <=> caddy glue<br>
</div>



---
## The Problem
<div class="fragment">
Setting up a Nomad cluster is... a lot ğŸ˜„
</div><br>

<div class="fragment">
install binaries Â· write configs Â· TLS certs
</div>
<div class="fragment">
service discovery Â· reverse proxy Â· secrets
</div><br>

<div class="fragment">
What if it was just:
</div>
<pre class="fragment fade-up"><code class="hljs bash"
>curl -sS httpsê‰//internetarchive.github.io/hind/install.sh | sudo sh
</code></pre>
<div class="fragment">
âœ… Done
</div>



---
HinD allows you to easily:
<div class="fragment">
hook in "gitops"
</div>

<div class="fragment">
deploy Git repositories to Nomad
</div>

<div class="fragment">
run web apps, jobs, crons
</div><br>

<h1 class="fragment">ğŸš€</h1>


---
## Minimal Requirements
<br>
<div class="fragment">
Â· VM with `podman` installed<br>
</div><br>

<div class="fragment">
Â· Wildcard DNS pointing to VM (idealy)<br>
  `*.example.com` â†’ your VM IP<br>
</div><br>

<div class="fragment">
That's it ğŸ‰
</div>


---
<!-- .slide: data-background="i/nomad.jpg" -->
<br>
Nomad jobs run as `podman` containers on your VM

<div class="fragment">
orchestrated by `nomad`, leveraging `/run/podman/podman.sock`
</div>



---
## Architecture
<section style="white-space:pre; text-align:left; font-size:80%; padding-left:15px; padding-top:0">
```
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†.
â€†â€†â€†â€†â€†â€†â€†â”Œâ”€â”€â”€â€†HinDâ€†containerâ€†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†nomadâ€†â†â”€â”€â”€â†’â€†consulâ€†â€†â€†â€†â€†â€†â€†caddyâ€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â†“â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â†‘â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†consul-templateâ€†â”€â”€â”€â”˜â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†/run/podman/podman.sock
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â€†â€†â€†VMâ€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚â€†â€†â€†â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†â€†â€†[jobâ€†A]â€†â€†â€†â€†â€†â€†[jobâ€†B]â€†â€†â€†â€†[jobâ€†C]â€†â€†â€†â”‚
â€†â€†â€†â€†â€†â€†â€†(podmanâ€†containers)â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â”‚
```
</section>



---
### consul-template: the magic glue ğŸª„
<div class="fragment">
`consul` knows what services are running
</div>
<div class="fragment">
& what hostnames they want
</div><br>

<div class="fragment">
`consul-template` watches consul
</div>
<div class="fragment">
& rewrites `caddy`'s config on the fly
</div><br>

<div class="fragment">
`caddy` picks up new config
</div>
<div class="fragment">
& on-demand requests a TLS cert
</div><br>

<div class="fragment">
deploy â†’ consul â†’ consul-template â†’ caddy â†’ ğŸ”’ HTTPS
</div>


---
### DEMO TIME!
<div class="fragment">
<img src=https://cdn.jsdelivr.net/gh/internetarchive/hind/img/hind.gif>
</div>


---
## Automatic HTTPS ğŸ”’
<div class="fragment">
Point  `*.example.com`  at your VM
</div><br>

<div class="fragment">
Deploy a job â†’ gets hostname like:<br>
`https://myorg-myrepo-mybranch.example.com`
</div><br>

<div class="fragment">
Caddy certs on-demand via Let's Encrypt / ZeroSSL
</div><br>

<div class="fragment">
No config. No cert management. Just works.
</div>


---
## Internal / Dev clusters
<div class="fragment">
No public DNS? No problem.
</div>
<pre class="fragment fade-up"><code class="hljs bash"
>curl .../install.sh | sudo sh -s -- -e CERTS_SELF_SIGNED=true
</code></pre>
<div class="fragment">
Caddy becomes its own internal CA<br>
Devs trust one cert once â†’ green padlock forever
</div>


---
## Multi-node cluster
<div class="fragment">
Want more VMs? It's 3 commands:
</div>
<pre class="fragment fade-up"><code class="hljs bash"
>FIRST=vm1.example.com

# copy 2 secrets from existing node
ssh $FIRST '...' | sudo podman secret create HIND_C -
ssh $FIRST '...' | sudo podman secret create HIND_N -

curl .../install.sh | sudo sh -s -- -e FIRST=$FIRST
</code></pre>
<div class="fragment">
Consul handles leader election & consensus<br>
Nomad schedules across all nodes
</div>


---
## HinD at Internet Archive ğŸ›ï¸
<div class="fragment lefty">
Â· multiple production clusters<br>
Â· multiple dev/staging clusters
</div>
<div class="fragment lefty">
Â· 100+ repos/webapps deployed<br>
Â· 1000+ review apps<br>
Â· 2x+ faster deploys vs. before
</div><br>

<div class="fragment lefty">
archive.org -- home, search & more pages<br>
â†’ <em>Run on nomad</em> ğŸš€
</div>


---
## GitOps with HinD
<div class="fragment">
Once HinD is running, you have:<br>
Â· `NOMAD_ADDR`<br>
Â· `NOMAD_TOKEN`
</div><br>

<div class="fragment">
Drop a GitHub Action / `gitlab-ci.yml` in your repo<br>
â†’ GitHub/GitLab deploys automatically
</div>


---
## We have helper repos

<div class="fragment">
secrets mgmt (nomad & consul KV storage)

<div class="fragment">
customizations

<div class="fragment">
info, hot copy edits, more

<div class="fragment">
https://github.com/internetarchive/cicd

<div class="fragment">
https://github.com/internetarchive/nomad
<div>


---
## Try it now ğŸš€
<pre><code class="hljs bash"
># 1. Install HinD
curl -sS https://internetarchive.github.io/hind/install.sh | sudo sh

# 2. Run a hello world job
export NOMAD_ADDR=https://$(hostname -f)
export NOMAD_VAR_BASE_DOMAIN=$(echo "$NOMAD_ADDR" | cut -f2- -d.)

nomad run https://internetarchive.github.io/hind/etc/hello-world.hcl
</code></pre>


---
## Lessons Learned / Gotchas
<div class="fragment">
Â· podman.socket must be enabled<br>
  (`sudo systemctl enable --now podman.socket`)
</div><br>

<div class="fragment">
Â· podman version matters â€” older = segfaults<br>
  fix: `--security-opt seccomp=unconfined`
</div><br>

<div class="fragment">
Â· pids-limit & num_locks â€” bump them for busy clusters
</div><br>

<div class="fragment">
Â· NFS for Persistent Volumes, shared across nodes
</div>


---
## tl;dr ğŸ¥±
GitHub Action<br>
- create file `.github/workflows/cicd.yml`
<div class="fragment">
  - use your HinD `NOMAD_ADDR`<br>
  - update `BASE_DOMAIN`
</div>

- use your HinD `NOMAD_TOKEN`
<div class="fragment">
  - [âš™ï¸ Settings > Security > Secrets > Actions > New repository secret](https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository)
</div>


---
## nomad project
- generic template:
  [project.nomad](https://github.com/internetarchive/nomad/blob/main/project.nomad)

- uses template vars + GitHub CI/CD variables


---
## [Customize](https://github.com/internetarchive/nomad#customizing)
Optional CI/CD vars for
[project.nomad](https://github.com/internetarchive/nomad/blob/main/project.nomad)

```
NOMAD_SECRET_MY_WEBHOOK
NOMAD_SECRET_DATABASE_URL

NOMAD_VAR_CPU
NOMAD_VAR_MEMORY

NOMAD_VAR_COUNT

NOMAD_VAR_HEALTH_TIMEOUT

NOMAD_VAR_HOSTNAMES
NOMAD_VAR_PORTS

NOMAD_VAR_PV
...
```
<div class="fragment">
Add any â˜ğŸ½ to your `cicd.yml`<br>
([more info](https://github.com/internetarchive/nomad/blob/main/README.md))
</div>


---
## References
### [HinD](https://github.com/internetarchive/hind)
### [CI/CD w/ nomad](https://github.com/internetarchive/nomad)

- [nomad](https://www.nomadproject.io/) - scheduler, etc.
- [consul](https://www.consul.io/) - networking, healthchecks
- [caddy](https://caddyserver.com/) - router, https, lets encrypt
- [consul-template](https://github.com/hashicorp/consul-template) - consul/caddy glue



---
## Thank You!
<section style="white-space:pre; text-align:left; font-size:80%; padding-left:15px; padding-top:0">
```
Â·â€†â€†â€†â€†â€†â€†â€†___â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†â€†/\â€†â€†\â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†___â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†â€†\â€†\--\â€†â€†â€†â€†â€†â€†â€†___â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†/\â€†â€†\â€†â€†â€†â€†â€†â€†â€†â€†__â€†__â€†â€†â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†â€†â€†\â€†\--\â€†â€†â€†â€†â€†/\__\â€†â€†â€†â€†â€†â€†â€†â€†â€†\â€†\--\â€†â€†â€†â€†â€†/â€†__â€†\__\â€†â€†â€†â€†Â·
Â·â€†â€†â€†___â€†/â€†â€†\--\â€†â€†â€†/â€†/__/â€†â€†â€†â€†â€†_____\â€†\--\â€†â€†â€†/â€†/__\â€†\__\â€†â€†â€†Â·
Â·â€†â€†/\_â€†/â€†/\â€†\__\â€†/â€†â€†\â€†_\â€†â€†â€†â€†/â€†______â€†\__\â€†/â€†/__/â€†\â€†|__|â€†â€†Â·
Â·â€†â€†\â€†\/â€†/_â€†\/__/â€†\/\â€†\â€†_\__â€†\â€†\__\â€†â€†\/__/â€†\â€†\__\â€†/â€†/__/â€†â€†Â·
Â·â€†â€†â€†\â€†â€†/__/â€†â€†â€†â€†â€†â€†â€†â€†â€†\â€†\/\__\â€†\â€†\__\â€†â€†â€†â€†â€†â€†â€†â€†\â€†\__/â€†/__/â€†â€†â€†Â·
Â·â€†â€†â€†â€†\â€†\â€†_\â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†\â€†â€†/_â€†/â€†â€†\â€†\__\â€†â€†â€†â€†â€†â€†â€†â€†\â€†\/â€†/__/â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†\â€†\__\â€†â€†â€†â€†â€†â€†â€†â€†â€†/â€†/_â€†/â€†â€†â€†â€†\/__/â€†â€†â€†â€†â€†â€†â€†â€†â€†\â€†â€†/__/â€†â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†â€†\/__/â€†â€†â€†â€†â€†â€†â€†â€†â€†\/__/â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†\/__/â€†â€†â€†â€†â€†â€†Â·
Â·â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†â€†Â·
```
<center>
slides: tracey.archive.org
repo: [gitlab/internetarchive](https://github.com/internetarchive/hind)
</center>
</section>

